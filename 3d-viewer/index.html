<!DOCTYPE html>
<html style="width: 100%; height: 100%">
  <head>
    <title>3D Viewer for TagSpaces</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
  </head>
  <script type="module" src="libs/model-viewer/model-viewer.min.js"></script>
  <script>
    function getParameterByName(paramName) {
      const name = paramName.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
      const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
      const results = regex.exec(location.search);
      let param =
        results === null
          ? ''
          : decodeURIComponent(results[1].replace(/\+/g, ' '));
      if (param.includes('#')) {
        param = param.split('#').join('%23');
      }
      return param;
    }

    const filePath = getParameterByName('file');
    const isWeb =
      (document.URL.startsWith('http') &&
        !document.URL.startsWith('http://localhost:1212/')) ||
      filePath.startsWith('http');

    document.onreadystatechange = () => {
      if (document.readyState === 'complete') {
        const modelViewer = document.querySelector('model-viewer');
        modelViewer.src = isWeb ? filePath : 'file://' + filePath;
      }

      // document
      //   .getElementById('screenshotButton')
      //   .addEventListener('click', () => {
      //     const viewer3D = document.createElement('model-viewer');
      //     // viewer3D.setAttribute('style', 'left: -10000px;');
      //     viewer3D.src =
      //       'file:///home/na/Desktop/3D-Models/apollo_exterior-150k-4096.glb';
      //     viewer3D.addEventListener('load', () => {
      //       const screenshotURL = viewer3D.toDataURL('image/jpg');
      //       const imageEl = document.getElementById('screenshotImg');
      //       imageEl.setAttribute('src', screenshotURL);
      //     });
      //     document.body.appendChild(viewer3D);
      //   });
    };
  </script>
  <body style="width: 100%; height: 100%; overflow: hidden; margin: 0;">
    <!-- <img
      id="screenshotImg"
      style="width: 200px; height: 200px"
      alt="screenshot"
    />
    <button id="screenshotButton">screenshot</button> -->
    <model-viewer
      style="width: 100%; height: 100%"
      ar
      shadow-intensity="1"
      camera-controls
      touch-action="pan-y"
    ></model-viewer>
  </body>
</html>
