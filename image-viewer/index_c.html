<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <link href="../libs/bootstrap5/bootstrap.min.css" rel="stylesheet" />
    <!-- <link href="../libs/viewerjs/viewer.min.css" rel="stylesheet" /> -->
    <link rel="stylesheet" href="../common/common.css" />
    <script src="../common/common.js"></script>
    <!-- <script src="../libs/viewerjs/viewer.min.js"></script> -->
    <script src="libs/viewer.js"></script>
    <script src="../libs/bootstrap5/bootstrap.bundle.min.js"></script>
    <script src="../libs/i18next/i18next.min.js"></script>
    <script src="../libs/file-saver/FileSaver.min.js"></script>
    <script src="libs/exif-js/exif.js"></script>
    <style>
      body {
        overflow: hidden;
        width: 100%;
        height: 100%;
      }

      .viewer-container {
        width: 100%;
        height: 100%;
      }

      #extFabMenu,
      #extFabMenu > ul {
        z-index: 3000;
      }

      .modal {
        z-index: 3002;
      }

      .viewer-button {
        visibility: hidden;
      }

      .viewer-backdrop {
        background-color: transparent;
      }

      #imageThumb {
        display: flex;
        position: absolute;
        width: 100%;
        height: 100%;
        margin: 7px;
        background-size: contain;
        background-position: center;
        background-repeat: no-repeat;
      }

      #progressBar {
        width: 100%;
        accent-color: var(--primary-background-color);
        height: 6px;
        position: absolute;
        top: -1px;
      }

      #documentWrapper {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        touch-action: none; /* Prevents browser "pull to refresh" or native zoom */
        background-color: transparent;
      }

      #imageContent {
        max-width: none;
        max-height: none;
        user-select: none;
        -webkit-user-drag: none;
        transform-origin: center center;
        will-change: transform;
        cursor: grab;
      }
    </style>
    <script>
      // --- Global Configuration ---
      let filePath = getParameterByName('file');
      const tmbPath = getParameterByName('thumb');
      const locale =
        getParameterByName('locale') === 'en'
          ? 'en_US'
          : getParameterByName('locale');
      const encrypted = getParameterByName('encrypted');

      const MIME_MAP = {
        '.jpg': 'image/jpeg',
        '.jpeg': 'image/jpeg',
        '.jfif': 'image/jpeg',
        '.pjpeg': 'image/jpeg',
        '.pjp': 'image/jpeg',
        '.png': 'image/png',
        '.avif': 'image/avif',
        '.gif': 'image/gif',
        '.svg': 'image/svg+xml',
        '.webp': 'image/webp',
      };

      let imageContent, imageViewerContainer;
      let viewer = {
        zoom: () => {},
        reset: () => {},
        rotate: () => {},
        flipH: () => {},
        flipV: () => {},
      };
      let imageBackgroundColor = '#000000';
      let flipState = { h: false, v: false, grayscale: false };

      // --- Utility: XHR Wrapper (Replacement for fetch) ---
      const requestBuffer = (url) =>
        new Promise((resolve, reject) => {
          const xhr = new XMLHttpRequest();
          xhr.responseType = 'arraybuffer';
          xhr.open('GET', url);
          xhr.onload = () =>
            xhr.status >= 400 ? reject(xhr.status) : resolve(xhr.response);
          xhr.onerror = () => reject(new Error('Network Error'));
          xhr.send();
        });

      // --- Utility: Script Loader ---
      const loadScript = (src) =>
        new Promise((resolve, reject) => {
          const script = document.createElement('script');
          script.src = src;
          script.onload = resolve;
          script.onerror = reject;
          document.head.appendChild(script);
        });

      // --- Utility: DataURL Converter ---
      const arrayBufferToDataURL = (buffer, mime) =>
        new Promise((resolve) => {
          const blob = new Blob([buffer], { type: mime });
          const reader = new FileReader();
          reader.onload = (e) => resolve(e.target.result);
          reader.readAsDataURL(blob);
        });

      // --- Specialized Format Handlers ---
      const FormatHandlers = {
        async tiff(path) {
          await loadScript('libs/utif.js/UTIF.js');
          const buffer = await requestBuffer(path);
          const ifds = UTIF.decode(buffer);
          return UTIF.bufferToURI(buffer, ifds[0]);
        },
        async psd(path) {
          await loadScript('libs/psd/dist/psd.min.js');
          const PSD = require('psd');
          const psd = await PSD.fromURL(path);
          return psd.image.toPng().getAttribute('src');
        },
        async tga(path) {
          await loadScript('libs/tga.js/tga.js');
          return new Promise((resolve) => {
            const tga = new TgaLoader();
            tga.open(path, () => resolve(tga.getDataURL('image/png')));
          });
        },
        async heic(path) {
          await loadScript('libs/libheif-wasm/libheif-bundle.js');
          const decoder = new (libheif().HeifDecoder)();
          const buffer = await requestBuffer(path);
          const data = decoder.decode(buffer);
          const handle = data[0];
          const canvas = document.createElement('canvas');
          canvas.width = handle.get_width();
          canvas.height = handle.get_height();
          const ctx = canvas.getContext('2d');
          const imgData = ctx.createImageData(canvas.width, canvas.height);

          await new Promise((res, rej) => {
            handle.display(imgData, (displayData) => {
              if (!displayData) return rej();
              ctx.putImageData(imgData, 0, 0);
              res();
            });
          });
          return canvas.toDataURL('image/jpeg', 0.9);
        },
      };

      // --- Content Handlers ---
      async function setContent(content) {
        if (!imageContent) return;
        const ext = filePath.split(/[?#]/)[0].split('.').pop().toLowerCase();
        const mime = MIME_MAP['.' + ext];

        if (mime) {
          const dataUrl = await arrayBufferToDataURL(content, mime);
          imageContent.setAttribute('src', dataUrl);
        } else {
          document.getElementById('encyptedMessage').style.display = 'block';
        }
      }

      // --- Main Init ---
      document.addEventListener('readystatechange', async () => {
        if (document.readyState !== 'complete') return;

        // UI Init
        insertAboutDialog('https://docs.tagspaces.org/extensions/image-viewer');
        insertPrintMenuItem();
        insertZoomContentMenuItem();
        initI18N(locale, 'ns.extension.json');

        imageContent = document.getElementById('imageContent');
        const imageThumb = document.getElementById('imageThumb');
        imageThumb.style.backgroundImage = `url("${tmbPath}")`;

        // Path Normalization
        if (!(isCordova || isWeb)) {
          filePath = 'file://' + filePath;
        }

        // Settings
        const extSettings = loadExtSettings('imageViewerSettings');
        if (extSettings?.imageBackgroundColor) {
          imageBackgroundColor = extSettings.imageBackgroundColor;
          document.body.style.background = imageBackgroundColor;
        }

        // Load File
        if (encrypted) {
          sendMessageToHost({ command: 'loadDefaultBinaryContent' });
        } else {
          const ext =
            '.' + filePath.split(/[?#]/)[0].split('.').pop().toLowerCase();
          try {
            if (['.cr2', '.dng', '.nef', '.tiff', '.tif'].includes(ext)) {
              imageContent.src = await FormatHandlers.tiff(filePath);
            } else if (ext === '.psd') {
              imageContent.src = await FormatHandlers.psd(filePath);
            } else if (ext === '.tga') {
              imageContent.src = await FormatHandlers.tga(filePath);
            } else if (ext === '.heic') {
              imageContent.src = await FormatHandlers.heic(filePath);
            } else {
              imageContent.src = filePath;
            }
          } catch (e) {
            console.error('Format loading error', e);
            imageContent.src = filePath; // Fallback
          }
        }

        // Viewer.js Setup
        imageContent.addEventListener('load', (e) => {
          const eTarget = event.target;
          viewer = initCustomViewer(imageContent);

          document.getElementById('progressBar').style.display = 'none';
          document.getElementById('imageThumb').style.display = 'none';

          // imageContent.style['visibility'] = 'hidden';

          if (!tmbPath) {
            //automatically generate thumb
            toDataURL(imageContent.src, (base64, err) => {
              if (err) return console.error(err);
              sendMessageToHost({
                command: 'thumbnailGenerated',
                content: base64,
              });
            });
          }

          // 3. Process metadata
          handleMetadata(imageContent);

          // viewer = new Viewer(imageContent, {
          //   movable: true,
          //   navbar: false,
          //   toolbar: false,
          //   title: false,
          //   transition: false,
          //   initialCoverage: 0.98,
          //   fullscreen: true,
          //   inline: 'inline',
          //   ready: () => viewer.full(),
          //   viewed: () => {
          //     document.getElementById('progressBar').style.display = 'none';
          //     imageThumb.style.display = 'none';
          //     imageViewerContainer =
          //       document.getElementsByClassName('viewer-container')[0];
          //     imageViewerContainer.style.background = 'transparent';
          //     imageContent.style['visibility'] = 'hidden';
          //     // Metadata handling
          //     handleMetadata(imageContent);

          //   },
          // });
        });

        setupUIListeners();
      });

      // --- Corrected Metadata Handling ---
      function handleMetadata(img) {
        // Safety Check: Ensure the image element exists and is loaded
        if (!img || !img.naturalWidth) {
          console.warn('Metadata requested but image not fully loaded yet.');
          return;
        }

        const meta = {
          Width: img.naturalWidth,
          Height: img.naturalHeight,
        };

        const isJpeg =
          filePath.toLowerCase().includes('.jpg') ||
          filePath.toLowerCase().includes('.jpeg');

        if (isJpeg && typeof EXIF !== 'undefined') {
          EXIF.getData(img, function () {
            const orientation = EXIF.getTag(this, 'Orientation');
            const oMap = {
              1: '0°',
              2: '0°, mirrored',
              3: '180°',
              4: '180°, mirrored',
              5: '90°',
              6: '90°, mirrored',
              7: '270°',
              8: '270°, mirrored',
            };

            if (orientation)
              meta['Orientation'] = oMap[orientation] || orientation;

            const tags = [
              'Make',
              'Model',
              'DateTime',
              'Artist',
              'Copyright',
              'ExposureTime ',
              'FNumber',
              'Flash',
              'WhiteBalance',
              'ISOSpeedRatings',
              'ShutterSpeedValue',
              'ApertureValue',
              'FocalLength',
              'GPSLatitude',
              'GPSLatitudeRef',
              'GPSLongitude',
              'GPSLongitudeRef',
            ];
            tags.forEach((tag) => {
              if (this.exifdata && this.exifdata[tag]) {
                meta[tag] = this.exifdata[tag];
              }
            });
            renderExif(Object.assign(meta, this.iptcdata || {}));
          });
        } else {
          renderExif(meta);
        }
      }

      function renderExif(data) {
        const container = document.getElementById('exifTableBody');
        if (!container) return;

        container.innerHTML = '';
        // Use Object.keys to be safer in older environments
        Object.keys(data).forEach((key) => {
          const val = data[key];
          if (val && val.toString().trim() !== '') {
            const tr = document.createElement('tr');
            tr.innerHTML = `<th style="color:black">${key}</th><td style="color:black">${val}</td>`;
            container.appendChild(tr);
          }
        });
      }

      // --- UI Logic ---
      function setupUIListeners() {
        const save = () =>
          saveExtSettings('imageViewerSettings', { imageBackgroundColor });

        if (isWeb || isCordova) {
          // TODO fix for saving images from web needed / security
          document.getElementById('exportJPGImage').style.display = 'none';
          document.getElementById('exportPNGImage').style.display = 'none';
          document.getElementById('exportWEBPImage').style.display = 'none';
          document.getElementById('exportImagesDelimiter').style.display =
            'none';
        }
        // Zoom & Rotate
        document.getElementById('zoomInButton').onclick = (e) => {
          e.stopPropagation();
          viewer.zoom(1);
        };
        document.getElementById('zoomOutButton').onclick = (e) => {
          e.stopPropagation();
          viewer.zoom(-1);
        };
        document.getElementById('zoomResetButton').onclick = () =>
          viewer.reset();
        document.getElementById('rotateLeftButton').onclick = (e) => {
          e.stopPropagation();
          viewer.rotate(-90);
        };
        document.getElementById('rotateRightButton').onclick = (e) => {
          e.stopPropagation();
          viewer.rotate(90);
        };

        // Flips
        document.getElementById('flipHorizontal').onclick = (e) => {
          e.stopPropagation();
          flipState.h = !flipState.h;
          viewer.flipH(flipState.h ? -1 : 1);
        };
        document.getElementById('flipVertical').onclick = (e) => {
          e.stopPropagation();
          flipState.v = !flipState.v;
          viewer.flipV(flipState.v ? -1 : 1);
        };

        // Colors & Filters
        const setBg = (color) => {
          imageBackgroundColor = color;
          document.body.style.background = color;
          if (imageViewerContainer)
            imageViewerContainer.style.background = color;
          save();
        };

        document.getElementById('whiteBackgroundColor').onclick = () =>
          setBg('#ffffff');
        document.getElementById('blackBackgroundColor').onclick = () =>
          setBg('#000000');

        document.getElementById('sepiaBackgroundColor').onclick = () =>
          setBg('#f4ecd8');
        document.getElementById('resetBackgroundColor').onclick = () =>
          setBg('transparent');

        document.getElementById('flipBlackAndWhiteColor').onclick = () => {
          viewer.toggleGrayscale();
        };

        // Exports (Using XHR inside toDataURL helper logic)
        const triggerDownload = (format) => {
          toDataURL(
            imageContent.src,
            (url) => {
              const xhr = new XMLHttpRequest();
              xhr.open('GET', url);
              xhr.responseType = 'blob';
              xhr.onload = () =>
                saveAs(
                  xhr.response,
                  `${extractFileName(filePath, isWin ? '\\' : '/')}.${format}`,
                );
              xhr.send();
            },
            format,
          );
        };

        document.getElementById('copyToClipboard').onclick = (e) => {
          toDataURL(
            imageContent.src,
            (dataURL) => {
              fetch(dataURL)
                .then((res) => res.blob())
                .then((blob) => {
                  const data = [new ClipboardItem({ [blob.type]: blob })];
                  navigator.clipboard.write(data);
                });
            },
            'png',
          );
        };

        document.getElementById('exportJPGImage').onclick = () =>
          triggerDownload('jpg');
        document.getElementById('exportPNGImage').onclick = () =>
          triggerDownload('png');

        // Fab Menu Height
        const fixMenu = () => {
          const menu = document.getElementById('fabMenu');
          if (menu) menu.style.maxHeight = window.innerHeight - 100 + 'px';
        };
        window.addEventListener('resize', fixMenu);
        fixMenu();
      }
    </script>
  </head>
  <body>
    <progress id="progressBar" aria-label="Image loading…"></progress>
    <div
      id="zoomIndicator"
      style="
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.6);
        color: white;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 0.9rem;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s;
        z-index: 1000;
      "
    >
      100%
    </div>
    <div
      id="encyptedMessage"
      data-i18n="encryptedFileUseDownload"
      style="display: none; text-align: center; padding: 20px"
    ></div>
    <div
      aria-busy="true"
      aria-describedby="progressBar"
      id="imageContainer"
      style="width: 100%; height: 100%; display: block; margin: auto"
    >
      <div id="imageThumb"></div>
      <img
        id="imageContent"
        style="width: 100%; height: 100%; display: block; margin: auto"
      />
    </div>
    <div id="aboutDialogPlaceholder"></div>
    <div
      class="modal fade"
      id="exifExtensionModal"
      tabindex="-1"
      aria-labelledby="exifModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5">
              <span data-i18n="exifTitle" />
            </h1>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <table
              class="table table-striped table-sm"
              style="font-size: smaller"
            >
              <thead>
                <!--tr><th>Key</th><th>Value</th></tr-->
              </thead>
              <tbody id="exifTableBody">
                <tr id="exifRow">
                  <th></th>
                  <td></td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-primary"
              data-bs-dismiss="modal"
            >
              <span data-i18n="ok" />
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="extFabMenu" class="btn-group dropup-center dropup">
      <button
        type="button"
        class="btn btn-primary btn-lg"
        data-bs-toggle="dropdown"
        aria-expanded="false"
      >
        <svg
          class="bi"
          width="24"
          height="24"
          focusable="false"
          aria-hidden="true"
        >
          <path
            d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"
          ></path>
        </svg>
      </button>
      <ul class="dropdown-menu" id="fabMenu" style="overflow-y: scroll">
        <li id="zoomContentMenuItemPlaceholder"></li>
        <li>
          <a id="fitToScreen" class="dropdown-item">
            <svg width="24" height="24" class="bi">
              <path
                d="m15 3 2.3 2.3-2.89 2.87 1.42 1.42L18.7 6.7 21 9V3h-6zM3 9l2.3-2.3 2.87 2.89 1.42-1.42L6.7 5.3 9 3H3v6zm6 12-2.3-2.3 2.89-2.87-1.42-1.42L5.3 17.3 3 15v6h6zm12-6-2.3 2.3-2.87-2.89-1.42 1.42 2.89 2.87L15 21h6v-6z"
              ></path>
            </svg>
            <span data-i18n="zoomReset" />
          </a>
        </li>
        <li><hr class="dropdown-divider" /></li>
        <li>
          <div id="rotateButtons" class="dropdown-item">
            <svg width="24" height="24" class="bi">
              <path
                d="M9 12c0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3-3 1.34-3 3z"
              ></path>
              <path
                d="M8 10V8H5.09C6.47 5.61 9.05 4 12 4c3.72 0 6.85 2.56 7.74 6h2.06c-.93-4.56-4.96-8-9.8-8-3.27 0-6.18 1.58-8 4.01V4H2v6h6zm8 4v2h2.91c-1.38 2.39-3.96 4-6.91 4-3.72 0-6.85-2.56-7.74-6H2.2c.93 4.56 4.96 8 9.8 8 3.27 0 6.18-1.58 8-4.01V20h2v-6h-6z"
              ></path>
            </svg>
            <div
              class="btn-group"
              data-toggle="buttons"
              style="width: 150px; border: 1px solid gray"
            >
              <button
                id="rotateRightButton"
                class="btn"
                data-i18ntitle="rotateRight"
                style="border-right: 1px solid gray"
              >
                <svg width="24" height="24" class="bi">
                  <path
                    d="M15.55 5.55 11 1v3.07C7.06 4.56 4 7.92 4 12s3.05 7.44 7 7.93v-2.02c-2.84-.48-5-2.94-5-5.91s2.16-5.43 5-5.91V10l4.55-4.45zM19.93 11c-.17-1.39-.72-2.73-1.62-3.89l-1.42 1.42c.54.75.88 1.6 1.02 2.47h2.02zM13 17.9v2.02c1.39-.17 2.74-.71 3.9-1.61l-1.44-1.44c-.75.54-1.59.89-2.46 1.03zm3.89-2.42 1.42 1.41c.9-1.16 1.45-2.5 1.62-3.89h-2.02c-.14.87-.48 1.72-1.02 2.48z"
                  ></path>
                </svg>
              </button>
              <button
                id="rotateLeftButton"
                class="btn"
                data-i18ntitle="rotateLeft"
              >
                <svg width="24" height="24" class="bi">
                  <path
                    d="M7.11 8.53 5.7 7.11C4.8 8.27 4.24 9.61 4.07 11h2.02c.14-.87.49-1.72 1.02-2.47zM6.09 13H4.07c.17 1.39.72 2.73 1.62 3.89l1.41-1.42c-.52-.75-.87-1.59-1.01-2.47zm1.01 5.32c1.16.9 2.51 1.44 3.9 1.61V17.9c-.87-.15-1.71-.49-2.46-1.03L7.1 18.32zM13 4.07V1L8.45 5.55 13 10V6.09c2.84.48 5 2.94 5 5.91s-2.16 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93s-3.05-7.44-7-7.93z"
                  ></path>
                </svg>
              </button>
            </div>
          </div>
        </li>
        <li>
          <div id="flipButtons" class="dropdown-item">
            <svg width="24" height="24" class="bi">
              <path
                d="M15.54 5.54 13.77 7.3 12 5.54 10.23 7.3 8.46 5.54 12 2zm2.92 10-1.76-1.77L18.46 12l-1.76-1.77 1.76-1.77L22 12zm-10 2.92 1.77-1.76L12 18.46l1.77-1.76 1.77 1.76L12 22zm-2.92-10 1.76 1.77L5.54 12l1.76 1.77-1.76 1.77L2 12z"
              ></path>
            </svg>
            <div
              class="btn-group"
              data-toggle="buttons"
              style="width: 150px; border: 1px solid gray"
            >
              <button
                id="flipHorizontal"
                class="btn"
                data-i18ntitle="flipHorizontal"
                style="border-right: 1px solid gray"
              >
                <svg width="24" height="24" class="bi">
                  <path
                    d="m18 12 4-4-4-4v3H3v2h15zM6 12l-4 4 4 4v-3h15v-2H6z"
                  ></path>
                </svg>
              </button>
              <button
                id="flipVertical"
                class="btn"
                data-i18ntitle="flipVertical"
              >
                <svg
                  width="24"
                  height="24"
                  style="transform: rotate(90deg)"
                  class="bi"
                >
                  <path
                    d="m18 12 4-4-4-4v3H3v2h15zM6 12l-4 4 4 4v-3h15v-2H6z"
                  ></path>
                </svg>
              </button>
            </div>
          </div>
        </li>
        <li><hr class="dropdown-divider" /></li>
        <li>
          <div class="dropdown-item" id="themeStyle">
            <svg width="24" height="24" class="bi">
              <path
                d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"
              ></path>
            </svg>
            <div
              class="btn-group"
              data-toggle="buttons"
              style="width: 180px; border: 1px solid gray"
            >
              <a
                id="whiteBackgroundColor"
                class="btn"
                style="width: 45px; background-color: #ffffff; color: #282a36"
                data-i18ntitle="changeBackgroundColor"
                >&nbsp;</a
              >
              <a
                id="blackBackgroundColor"
                class="btn"
                style="width: 45px; background-color: #282a36; color: #ffffff"
                data-i18ntitle="changeBackgroundColor"
                >&nbsp;</a
              >
              <a
                id="sepiaBackgroundColor"
                class="btn"
                style="width: 45px; background-color: #f4ecd8; color: #5b4636"
                data-i18ntitle="changeBackgroundColor"
                >&nbsp;</a
              >
              <a
                id="resetBackgroundColor"
                class="btn"
                style="width: 45px; background-color: #ffffff; color: #050505"
                data-i18ntitle="resetBackgroundColor"
              >
                <svg width="24" height="24" class="bi">
                  <path
                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8 0-1.85.63-3.55 1.69-4.9L16.9 18.31C15.55 19.37 13.85 20 12 20zm6.31-3.1L7.1 5.69C8.45 4.63 10.15 4 12 4c4.42 0 8 3.58 8 8 0 1.85-.63 3.55-1.69 4.9z"
                  ></path>
                </svg>
              </a>
            </div>
          </div>
        </li>
        <li>
          <a id="flipBlackAndWhiteColor" class="dropdown-item">
            <svg width="24" height="24" class="bi">
              <path
                d="M12 22c5.52 0 10-4.48 10-10S17.52 2 12 2 2 6.48 2 12s4.48 10 10 10zm1-17.93c3.94.49 7 3.85 7 7.93s-3.05 7.44-7 7.93V4.07z"
              ></path>
            </svg>
            <span data-i18n="toggleBlackAndWhiteColor"></span>
          </a>
        </li>
        <li id="exportImagesDelimiter"><hr class="dropdown-divider" /></li>
        <li>
          <a id="exportJPGImage" class="dropdown-item" href="#">
            <svg width="24" height="24" class="bi">
              <path
                d="m16 5-1.42 1.42-1.59-1.59V16h-1.98V4.83L9.42 6.42 8 5l4-4 4 4zm4 5v11c0 1.1-.9 2-2 2H6c-1.11 0-2-.9-2-2V10c0-1.11.89-2 2-2h3v2H6v11h12V10h-3V8h3c1.1 0 2 .89 2 2z"
              ></path>
            </svg>
            <span
              data-i18n="exportJPGImage"
              data-i18ntitle="exportJPGImageTitle"
            />
          </a>
        </li>
        <li>
          <a id="exportPNGImage" class="dropdown-item" href="#">
            <svg width="24" height="24" class="bi">
              <path
                d="m16 5-1.42 1.42-1.59-1.59V16h-1.98V4.83L9.42 6.42 8 5l4-4 4 4zm4 5v11c0 1.1-.9 2-2 2H6c-1.11 0-2-.9-2-2V10c0-1.11.89-2 2-2h3v2H6v11h12V10h-3V8h3c1.1 0 2 .89 2 2z"
              ></path>
            </svg>
            <span data-i18n="exportPNGImage" />
          </a>
        </li>
        <li>
          <a id="exportWEBPImage" class="dropdown-item" href="#">
            <svg width="24" height="24" class="bi">
              <path
                d="m16 5-1.42 1.42-1.59-1.59V16h-1.98V4.83L9.42 6.42 8 5l4-4 4 4zm4 5v11c0 1.1-.9 2-2 2H6c-1.11 0-2-.9-2-2V10c0-1.11.89-2 2-2h3v2H6v11h12V10h-3V8h3c1.1 0 2 .89 2 2z"
              ></path>
            </svg>
            <span data-i18n="exportWEBPImage" />
          </a>
        </li>
        <li><hr class="dropdown-divider" /></li>
        <li>
          <a id="copyToClipboard" class="dropdown-item" href="#">
            <svg width="24" height="24" class="bi">
              <path
                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"
              ></path>
            </svg>
            <span
              data-i18n="copyToClipboard"
              data-i18ntitle="copyToClipboardTitle"
            />
          </a>
        </li>
        <li>
          <a
            id="exifButton"
            class="dropdown-item"
            data-bs-toggle="modal"
            data-bs-target="#exifExtensionModal"
            ><svg width="24" height="24" class="bi">
              <circle cx="12" cy="12" r="3.2"></circle>
              <path
                d="M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"
              ></path>
            </svg>
            <span data-i18n="exif"></span>
          </a>
        </li>
        <li id="printMenuItemPlaceholder"></li>
        <li><hr class="dropdown-divider" /></li>
        <li id="aboutMenuItemPlaceholder"></li>
      </ul>
    </div>
  </body>
</html>
