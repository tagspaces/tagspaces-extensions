<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <title>URL Viewer for TagSpaces</title>
    <link rel="stylesheet" href="../libs/bootstrap5/bootstrap.min.css" />
    <link rel="stylesheet" href="../common/common.css" />
    <script src="../libs/bootstrap5/bootstrap.bundle.min.js"></script>
    <script src="../libs/i18next/i18next.min.js"></script>
    <script src="../common/common.js"></script>
    <script>
      const filePath = getParameterByName('file');
      let locale = getParameterByName('locale');
      if (locale === 'en') {
        locale = 'en_US';
      }

      document.addEventListener('readystatechange', () => {
        if (document.readyState === 'complete') {
          sendMessageToHost({ command: 'loadDefaultTextContent' });

          insertAboutDialog('https://docs.tagspaces.org/extensions/url-viewer');

          initI18N(locale, 'ns.extension.json');

          document
            .getElementById('printMenuItem')
            .addEventListener('click', openPrintDialog);
        }
      });

      function setContent(content) {
        const urlBegin = 'URL=';
        const commentTag = 'COMMENT=';
        let url = content.substring(
          content.indexOf(urlBegin) + urlBegin.length,
          content.length
        );

        let comment = content.substring(
          content.indexOf(commentTag) + commentTag.length,
          content.length
        );

        // preventing the case the url is at the end of the file or line after the url lines
        url = url + '\n';
        url = url.substring(0, url.indexOf('\n'));

        const openURLButton = document.getElementById('openURLButton');
        openURLButton.addEventListener('click', e => {
          e.preventDefault();
          const msg = { command: 'openLinkExternally', link: url };
          sendMessageToHost(msg);
        });

        const urlInput = document.getElementById('urlInput');
        urlInput.setAttribute('value', url);

        if (comment.startsWith('data:image')) {
          const screenshotImg = document.getElementById('screenshotImg');
          screenshotImg.setAttribute('src', comment);
          screenshotImg.style['display'] = 'block';
        }
      }
    </script>
  </head>
  <body>
    <div style="margin: 10px;">
      <div class="input-group">
        <input
          id="urlInput"
          type="text"
          class="form-control"
          value="URL of the bookmark"
          aria-label="readonly input example"
          readonly
        />
        <button
          type="button"
          id="openURLButton"
          title="Opens the URL in the default browser"
          class="btn btn-primary btn-sm"
        >
          <svg width="16" height="16" class="bi">
            <path
              fill-rule="evenodd"
              d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"
            />
            <path
              fill-rule="evenodd"
              d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"
            />
          </svg>
          <span data-i18n="openURL" />
        </button>
      </div>
      <img
        id="screenshotImg"
        title="Screenshot of the original web page"
        style="margin-top: 10px; width: 100%; display: none"
      />
    </div>
    <div id="extFabMenu" class="btn-group dropup-center dropup">
      <button
        type="button"
        class="btn btn-primary  btn-lg"
        data-bs-toggle="dropdown"
        aria-expanded="false"
      >
        â‹®
      </button>
      <ul class="dropdown-menu">
        <li>
          <a id="printMenuItem" class="dropdown-item" href="#">
            <svg width="24" height="24" class="bi">
              <path
                d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"
              ></path>
            </svg>
            <span data-i18n="print" />
          </a>
        </li>
        <li><hr class="dropdown-divider" /></li>
        <li>
          <a
            class="dropdown-item"
            href="#"
            data-bs-toggle="modal"
            data-bs-target="#aboutModal"
          >
            <svg width="24" height="24" class="bi">
              <path
                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"
              ></path>
            </svg>
            <span data-i18n="about" />
          </a>
        </li>
      </ul>
    </div>
  </body>
</html>
